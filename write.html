<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ·»åŠ æ•°æ®</title>
    <style>
        :root {
            --brand-color: #2d6a4f;
            --brand-light: rgba(240, 249, 244, 0.9);
            --brand-hover: rgba(220, 237, 226, 0.95);
            --material-bg: #fffcf0;
            --text-main: #1a202c;
            --text-muted: #4a5568;
            --nav-bg: rgba(255, 255, 255, 0.85);
        }

        body { 
            margin: 0; 
            font-family: "Georgia", "PingFang SC", serif; 
            background: #1a202c url('sea.avif') no-repeat center center fixed;
            background-size: cover;
            padding-top: 60px; 
            color: var(--text-main);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        .top-nav {
            position: fixed; top: 0; width: 100%; height: 60px;
            background: var(--nav-bg); backdrop-filter: blur(12px);
            z-index: 1000; display: flex; align-items: center; padding: 0 20px;
            box-sizing: border-box; box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        .nav-item { cursor: pointer; font-weight: bold; color: var(--brand-color); text-decoration: none; font-size: 1rem; transition: 0.3s; }
        
        .music-controls { display: flex; align-items: center; gap: 5px; margin-left: auto; }
        .music-btn { width: 32px; height: 32px; background: none; border: none; cursor: pointer; color: var(--brand-color); display: flex; align-items: center; justify-content: center; transition: 0.2s; border-radius: 50%; padding: 0; opacity: 0.7; }
        .music-btn.skip { font-size: 0.8rem; opacity: 0.5; pointer-events: auto; }

        .hero-banner {
            height: 200px; 
            width: 100%; position: relative;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            -webkit-mask-image: linear-gradient(to bottom, black 0%, black 70%, transparent 100%);
        }
        @media (min-width: 768px) { .hero-banner { height: 300px; } }

        .hero-slideshow {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1.5s ease-in-out, transform 4.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            opacity: 0; z-index: 1;
        }
        .hero-slideshow.active { opacity: 1; z-index: 2; }

        .hero-title-box {
            position: relative; z-index: 10; 
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px); 
            padding: 15px 25px; border-radius: 12px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s ease;
            cursor: pointer;
            width: 80%;
            max-width: 400px;
        }
        .hero-title-box:hover { opacity: 0.2; transform: translateY(-2px); }
        .hero-title { font-size: 1.4rem; margin: 0; color: white; letter-spacing: 2px; text-shadow: 0 2px 10px rgba(0,0,0,0.4); }
        @media (min-width: 768px) { .hero-title { font-size: 2.2rem; } .hero-title-box { padding: 30px 50px; width: auto; } }

        .main-container { max-width: 900px; margin: -20px auto 60px; position: relative; z-index: 20; padding: 0 15px; }
        @media (min-width: 768px) { .main-container { margin-top: -40px; } }

        .mode-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            background: rgba(255,255,255,0.8); padding: 8px 20px; border-radius: 20px;
            cursor: pointer; font-weight: bold; color: var(--brand-color); border: none;
            transition: 0.3s; font-size: 0.9rem;
        }
        .tab-btn.active { background: var(--brand-color); color: white; box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3); }

        .write-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        @media (min-width: 768px) { .write-card { padding: 40px; border-radius: 20px; } }

        .meta-grid { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        @media (min-width: 600px) { .meta-grid { grid-template-columns: 1fr 1fr; } }

        .input-group { display: flex; flex-direction: column; gap: 6px; }
        label { font-weight: bold; color: var(--brand-color); font-size: 0.8rem; }
        input, select, textarea { 
            padding: 10px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; 
            background: white; font-family: inherit; font-size: 16px; 
        }

        .readers-container { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 15px; 
            padding: 15px; 
            background: var(--brand-light); 
            border-radius: 12px; 
            margin-top: 20px; 
        }
        @media (min-width: 600px) { .readers-container { grid-template-columns: 1fr 1fr; } }
        
        .reader-box { display: flex; flex-direction: column; gap: 12px; }
        .reader-title { font-weight: bold; border-bottom: 1px solid var(--brand-color); padding-bottom: 5px; color: var(--brand-color); }

        .content-cell { position: relative; margin-bottom: 15px; padding: 20px 15px; border-radius: 10px; border-left: 5px solid #ccc; background: #fff; }
        .cell-material { border-left-color: #e9d8a6; background: var(--material-bg); }
        .cell-comment { border-left-color: var(--brand-color); background: var(--brand-light); }
        .cell-type-tag { position: absolute; top: -8px; right: 10px; font-size: 0.65rem; padding: 2px 10px; border-radius: 10px; color: white; font-weight: bold; }
        .cell-textarea { width: 100%; min-height: 80px; border: none; background: transparent; outline: none; resize: vertical; font-size: 1rem; box-sizing: border-box; }

        .actions { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; }
        @media (min-width: 600px) { .actions { flex-direction: row; justify-content: center; } }

        .btn { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; font-family: inherit; text-align: center; }
        .btn-gen { background: #1a202c; color: white; width: 100%; font-size: 1rem; }
        .btn-del { background: transparent; color: #e63946; font-size: 0.75rem; border: 1px solid #e63946; margin-top: 8px; padding: 4px 10px; width: fit-content; }
        
        #output-area { 
            margin-top: 25px; background: #1e1e1e; color: #d4d4d4; padding: 15px; 
            border-radius: 10px; font-family: "Consolas", monospace; white-space: pre-wrap; 
            word-break: break-all; display: none; border-left: 5px solid #007acc; font-size: 0.8rem; 
            overflow-x: auto;
        }
    </style>
</head>
<body>

<nav class="top-nav">
    <a href="index.html" class="nav-item">ğŸŒŠ è¿”å›</a>
    <div class="music-controls">
        <button class="music-btn skip" id="prev-btn">â®</button>
        <button class="music-btn" id="music-toggle">â–¶</button>
        <button class="music-btn skip" id="next-btn">â­</button>
    </div>
</nav>

<header class="hero-banner">
    <div id="slide1" class="hero-slideshow active"></div>
    <div id="slide2" class="hero-slideshow"></div>
    <div class="hero-title-box">
        <h1 class="hero-title" id="page-title">ğŸ“ ç¬”è®°ç”Ÿæˆ</h1>
    </div>
</header>

<main class="main-container">
    <div class="mode-tabs">
        <div class="tab-btn active" onclick="switchMode('note', event)">è¯»ä¹¦ç¬”è®°</div>
        <div class="tab-btn" onclick="switchMode('toread', event)">ä¹¦å•&å½±å•</div>
    </div>

    <div class="write-card">
        <div id="note-form">
            <div class="meta-grid">
                <div class="input-group"><label>æ ‡é¢˜</label><input type="text" id="title"></div>
                <div class="input-group"><label>ä½œè€…</label><input type="text" id="author"></div>
                <div class="input-group"><label>æ—¶é—´</label><input type="date" id="time"></div>
                <div class="input-group"><label>æ¥æº</label><input type="text" id="source"></div>
                <div class="input-group">
                    <label>ç±»å‹</label>
                    <select id="type">
                        <option value="ä¹¦">ä¹¦</option>
                        <option value="è®ºæ–‡">è®ºæ–‡</option>
                        <option value="å½±è§†">å½±è§†</option>
                        <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                    </select>
                </div>
                <div class="input-group"><label>æ ‡ç­¾ (é€—å·éš”å¼€)</label><input type="text" id="tag"></div>
            </div>
            <div id="cells-container">
                <div class="content-cell cell-material" data-type="material">
                    <span class="cell-type-tag">æ‘˜æŠ„å—</span>
                    <textarea class="cell-textarea" placeholder="è¾“å…¥æ‘˜æŠ„å†…å®¹..."></textarea>
                </div>
            </div>
            <div class="actions">
                <button class="btn" style="background:#e9d8a6; color:#5f4d1a;" onclick="addCell('material')">+ å¢åŠ æ‘˜æŠ„</button>
                <button class="btn" style="background:var(--brand-color); color:white;" onclick="addCell('comment')">+ å¢åŠ æ„Ÿæƒ³</button>
            </div>
        </div>

        <div id="toread-form" style="display: none;">
            <div class="meta-grid">
                <div class="input-group"><label>åç§°</label><input type="text" id="tr-title"></div>
                <div class="input-group"><label>ä½œè€…</label><input type="text" id="tr-author"></div>
                <div class="input-group"><label>è¯‘è€…</label><input type="text" id="tr-translator"></div>
                <div class="input-group"><label>å‡ºç‰ˆç¤¾</label><input type="text" id="tr-press"></div>
                <div class="input-group"><label>é¢†åŸŸ</label><input type="text" id="tr-field"></div>
                <div class="input-group"><label>å°é¢åç¼€(jpg,pngç­‰)</label><input type="text" id="tr-ext" value="jpg"></div>
                <div class="input-group" style="grid-column: 1 / -1;"><label>ç®€ä»‹/ç†ç”±</label><textarea id="tr-reason" style="min-height: 60px;"></textarea></div>
	<div class="input-group">
    <label>åª’ä»‹ç±»å‹</label>
    <select id="tr-media">
        <option value="book">ğŸ“– ä¹¦ç±</option>
        <option value="movie">ğŸ¬ å½±è§†ä½œå“</option>
    </select>
</div>

            </div>
            <div class="readers-container">
                <div class="reader-box">
                    <div class="reader-title">ğŸ± çŒ«çŒ«</div>
                    <div class="input-group">
                        <select id="tr-status-cat">
                            <option value="">ç©º</option>
                            <option value="todo">æƒ³çœ‹</option>
                            <option value="reading">åœ¨çœ‹</option>
                            <option value="completed">å·²çœ‹</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <input type="date" id="tr-date-cat">
                    </div>
                    <div class="input-group">
                        <label>è¯„åˆ†</label>
                        <input type="number" step="0.5" id="tr-score-cat" value="">
                    </div>
                </div>
                <div class="reader-box">
                    <div class="reader-title">ğŸ‘ å’©å’©</div>
                    <div class="input-group">
                        <select id="tr-status-mie">
                            <option value="">ç©º</option>
                            <option value="todo">æƒ³çœ‹</option>
                            <option value="reading">åœ¨çœ‹</option>
                            <option value="completed">å·²çœ‹</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <input type="date" id="tr-date-mie">
                    </div>
                    <div class="input-group">
                        <label>è¯„åˆ†</label>
                        <input type="number" step="0.5" id="tr-score-mie" value="">
                    </div>
                </div>
            </div>
        </div>

        <button class="btn btn-gen" style="margin-top: 20px;" onclick="generateData()">âœ¨ ç”Ÿæˆ JSON ä»£ç </button>
        <pre id="output-area"></pre>
    </div>
</main>

<script>
    const imageData = [
        { src: '1.jpg', scale: 1.0 }, { src: '2.jpg', scale: 1.05 }, { src: '3.jpg', scale: 1.1 },
        { src: '4.jpg', scale: 1.0 }, { src: '5.jpg', scale: 1.05 }, { src: '6.jpg', scale: 1.1 },
        { src: '7.jpg', scale: 1.0 }, { src: '8.jpg', scale: 1.05 }, { src: '9.jpg', scale: 1.1 },
        { src: '10.png', scale: 1.0 }, { src: '11.jpg', scale: 1.05 }, { src: '12.jpg', scale: 1.1 }
    ];

    const preCache = [];
    imageData.forEach(data => { const img = new Image(); img.src = data.src; preCache.push(img); });

    let slideIdx = 0;
    const slide1 = document.getElementById('slide1');
    const slide2 = document.getElementById('slide2');
    let activeSlide = slide1;

    slide1.style.backgroundImage = `url('${imageData[0].src}')`;
    slide1.style.transform = `scale(${imageData[0].scale})`;

    function changeSlide() {
        slideIdx = (slideIdx + 1) % imageData.length;
        const nextSlide = (activeSlide === slide1) ? slide2 : slide1;
        nextSlide.style.backgroundImage = `url('${imageData[slideIdx].src}')`;
        nextSlide.style.transform = `scale(${imageData[slideIdx].scale})`;
        nextSlide.classList.add('active');
        activeSlide.classList.remove('active');
        activeSlide = nextSlide;
    }
    setInterval(changeSlide, 4500);

    const MUSIC_FILES = ['jazz.mp3', 'Over_Reprise.mp3', 'jazz2.mp3', 'jazz3.mp3'];
    let currentTrackIndex = 0;
    const audio = new Audio();
    audio.volume = 0.3;
    const musicToggleBtn = document.getElementById('music-toggle');

    function loadTrack(index) {
        currentTrackIndex = (index + MUSIC_FILES.length) % MUSIC_FILES.length;
        audio.src = MUSIC_FILES[currentTrackIndex];
        audio.load();
    }
    musicToggleBtn.addEventListener('click', () => {
        if (!audio.src) loadTrack(0);
        if (audio.paused) { audio.play().then(() => musicToggleBtn.textContent = 'â¸'); }
        else { audio.pause();
        musicToggleBtn.textContent = 'â–¶'; }
    });
    document.getElementById('prev-btn').onclick = () => { loadTrack(currentTrackIndex - 1); audio.play(); musicToggleBtn.textContent = 'â¸'; };
    document.getElementById('next-btn').onclick = () => { loadTrack(currentTrackIndex + 1); audio.play(); musicToggleBtn.textContent = 'â¸'; };

    let currentMode = 'note';
    function switchMode(mode, event) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        if(event) event.target.classList.add('active');
        document.getElementById('note-form').style.display = mode === 'note' ? 'block' : 'none';
        document.getElementById('toread-form').style.display = mode === 'toread' ? 'block' : 'none';
        document.getElementById('page-title').textContent = mode === 'note' ? 'ğŸ“ ç¬”è®°ç”Ÿæˆ' : 'ğŸ“– ä¹¦å•&å½±å•';
    }

    function addCell(type) {
        const div = document.createElement('div');
        div.className = `content-cell cell-${type}`;
        div.setAttribute('data-type', type);
        div.innerHTML = `<span class="cell-type-tag">${type==='material'?'æ‘˜æŠ„':'æ„Ÿæƒ³'}</span><textarea class="cell-textarea"></textarea><button class="btn btn-del" onclick="this.parentElement.remove()">åˆ é™¤</button>`;
        document.getElementById('cells-container').appendChild(div);
    }

    function generateData() {
        let result = {};
        const key = (currentMode === 'note' ? 'n_id' : 'tr_id');
        
        if (currentMode === 'note') {
            const cells = document.querySelectorAll('.content-cell');
            let contents = [];
            let currentGroup = null;
            cells.forEach(cell => {
                const type = cell.getAttribute('data-type');
                const val = cell.querySelector('textarea').value;
                if (type === 'material') { 
                    currentGroup = { "material": val, "comments": [] }; 
                    contents.push(currentGroup); 
                } else if (currentGroup) { 
                    currentGroup.comments.push(val); 
                }
            });
            result[key] = {
                "title": document.getElementById('title').value,
                "author": document.getElementById('author').value,
                "time": document.getElementById('time').value,
                "source": document.getElementById('source').value,
                "type": document.getElementById('type').value,
                "tag": document.getElementById('tag').value.split(',').map(s=>s.trim()).filter(s=>s),
                "contents": contents
            };
        } else {
            const readers = {}; const completeTime = {}; const score = {};
            const statusCat = document.getElementById('tr-status-cat').value;
            const statusMie = document.getElementById('tr-status-mie').value;
            if (statusCat) {
                readers["çŒ«"] = statusCat;
                completeTime["çŒ«"] = document.getElementById('tr-date-cat').value;
                score["çŒ«"] = document.getElementById('tr-score-cat').value;
            }
            if (statusMie) {
                readers["å’©"] = statusMie;
                completeTime["å’©"] = document.getElementById('tr-date-mie').value;
                score["å’©"] = document.getElementById('tr-score-mie').value;
            }
            const mediaType = document.getElementById('tr-media').value;
	    const videoFlag = mediaType === 'movie';


            result[key] = {
                "video": videoFlag,
                "title": document.getElementById('tr-title').value,
                "author": document.getElementById('tr-author').value,
                "translator": document.getElementById('tr-translator').value,
                "press": document.getElementById('tr-press').value,
                "coverExt": document.getElementById('tr-ext').value,
                "field": document.getElementById('tr-field').value,
                "reason": document.getElementById('tr-reason').value,
                "readers": readers, 
                "complete_time": completeTime, 
                "score": score
            };
        }

        const str = JSON.stringify(result, null, 2);
        const output = document.getElementById('output-area');
        output.textContent = str.substring(1, str.length - 1).trim() + ",";
        output.style.display = 'block';
        output.scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('time').valueAsDate = new Date();
</script>

</body>
</html>
